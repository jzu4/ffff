<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ضغط الصور | أدوات تحرير الصور</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        
        * {
            font-family: 'Tajawal', sans-serif;
        }

        :root {
            --primary-color: #10b981;
            --primary-hover: #059669;
            --secondary-color: #1f2937;
            --bg-color: #111827;
            --text-color: #f3f4f6;
            --card-color: #1e293b;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            background-image: 
                radial-gradient(circle at 25px 25px, rgba(16, 185, 129, 0.1) 2%, transparent 0%), 
                radial-gradient(circle at 75px 75px, rgba(245, 158, 11, 0.1) 2%, transparent 0%);
            background-size: 100px 100px;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background-color: var(--primary-hover);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background-color: #2d3748;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-danger:hover:not(:disabled) {
            background-color: #dc2626;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-warning:hover:not(:disabled) {
            background-color: #d97706;
        }
        
        .card {
            background-color: var(--card-color);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 0.5rem;
            object-fit: contain;
        }
        
        .drop-zone {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            background-color: rgba(31, 41, 55, 0.5);
            transition: all 0.3s;
        }
        
        .drop-zone:hover, .drop-zone.active {
            border-color: var(--primary-color);
            background-color: rgba(16, 185, 129, 0.1);
        }
        
        .section {
            background-color: var(--card-color);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .step {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 1rem;
        }
        
        .step-text {
            flex: 1;
        }
        
        .feature-box {
            background-color: rgba(31, 41, 55, 0.7);
            border-radius: 0.75rem;
            padding: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }
        
        .feature-box:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .feature-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 1rem;
        }
        
        .settings-slider {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #374151;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        .settings-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            border: 2px solid white;
        }
        
        .social-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            color: white;
            transition: all 0.2s;
        }
        
        .social-btn:hover {
            transform: translateY(-3px);
        }
        
        .twitter-btn {
            background-color: #1DA1F2;
        }
        
        .twitter-btn:hover {
            background-color: #0c85d0;
            box-shadow: 0 4px 8px rgba(29, 161, 242, 0.4);
        }
        
        .telegram-btn {
            background-color: #0088cc;
        }
        
        .telegram-btn:hover {
            background-color: #0077b5;
            box-shadow: 0 4px 8px rgba(0, 136, 204, 0.4);
        }
        
        .footer-link {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .footer-link:hover {
            color: #fbbf24;
            text-decoration: underline;
        }
        
        .sticky-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background-color: rgba(31, 41, 55, 0.8);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
            backdrop-filter: blur(4px);
            z-index: 10;
        }
        
        .loading-text {
            margin-top: 1rem;
            color: white;
            font-weight: 500;
        }
        
        .result-download-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background-color: var(--success-color);
            color: white;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .result-download-btn:hover {
            transform: translateY(-2px);
            background-color: #059669;
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
        }
        
        /* Custom styles for this tool */
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #374151;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }
        
        .progress-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .size-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 0.5rem;
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .size-badge.original {
            background-color: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }
        
        .size-badge.compressed {
            background-color: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }
        
        .file-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: rgba(31, 41, 55, 0.7);
        }
        
        .format-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: rgba(31, 41, 55, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .format-option:hover, .format-option.active {
            background-color: rgba(16, 185, 129, 0.1);
            border-color: var(--primary-color);
        }
        
        .format-icon {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .comparison-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .comparison-image-container {
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
            background-color: rgba(31, 41, 55, 0.7);
            padding: 0.5rem;
        }
        
        .comparison-label {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            z-index: 5;
        }
        
        .original-label {
            background-color: rgba(245, 158, 11, 0.8);
            color: white;
        }
        
        .compressed-label {
            background-color: rgba(16, 185, 129, 0.8);
            color: white;
        }
        
        @media (max-width: 768px) {
            .section-title {
                font-size: 1.1rem;
            }
            
            .feature-icon {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
            
            .step-number {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }
            
            .comparison-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <!-- شريط التنقل -->
    <nav class="sticky-nav shadow-lg py-3 px-4 mb-8">
        <div class="container mx-auto flex flex-wrap justify-between items-center">
            <div class="flex items-center">
                <a href="index.html" class="text-2xl font-bold flex items-center gap-2">
                    <i class="fas fa-crop-alt text-green-500"></i>
                    <span>أدوات الصور</span>
                </a>
            </div>
            
            <div class="hidden md:flex items-center space-x-4 rtl:space-x-reverse">
                <a href="index.html" class="nav-link">الرئيسية</a>
                <a href="color-replacer.html" class="nav-link">تغيير الألوان</a>
                <a href="background-remover.html" class="nav-link">إزالة الخلفية</a>
                <a href="#" class="nav-link active">ضغط الصور</a>
            </div>
            
            <div>
                <a href="index.html" class="btn btn-secondary">
                    <i class="fas fa-arrow-right ml-1"></i>
                    العودة للرئيسية
                </a>
            </div>
        </div>
    </nav>

    <div class="container mx-auto">
        <!-- العنوان -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-black mb-3">ضغط الصور</h1>
            <p class="text-xl text-gray-400 max-w-3xl mx-auto">
                تقليل حجم ملفات الصور مع الحفاظ على الجودة المرئية
            </p>
        </header>

        <!-- المحتوى الرئيسي -->
        <div class="card p-6">
            <!-- منطقة التحميل -->
            <div id="uploadSection" class="section">
                <h2 class="section-title">
                    <i class="fas fa-upload text-green-500"></i>
                    اختيار الصورة
                </h2>
                <div id="dropZone" class="drop-zone p-8 mb-4 flex flex-col items-center justify-center cursor-pointer">
                    <i class="fas fa-cloud-upload-alt text-gray-500 text-6xl mb-4"></i>
                    <div class="text-center">
                        <p class="text-lg font-medium mb-1">اسحب واترك الصورة هنا</p>
                        <p class="text-sm text-gray-400 mb-4">أو انقر لاختيار ملف (JPG أو PNG)</p>
                        <button id="selectFileBtn" class="btn btn-primary">
                            <i class="fas fa-image ml-2"></i>
                            اختر صورة
                        </button>
                    </div>
                    <input type="file" id="fileInput" accept="image/jpeg,image/png" class="hidden">
                </div>
            </div>

            <div id="editorContainer" class="hidden">
                <!-- إعدادات الضغط -->
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-sliders-h text-green-500"></i>
                        إعدادات الضغط
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">مستوى الضغط</label>
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm text-gray-400">أكثر جودة</span>
                                <span id="qualityValueDisplay" class="text-green-400 font-semibold">80%</span>
                                <span class="text-sm text-gray-400">ضغط أعلى</span>
                            </div>
                            <input type="range" id="qualitySlider" class="settings-slider" min="30" max="100" value="80">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">تنسيق الملف المضغوط</label>
                            <div class="grid grid-cols-3 gap-2">
                                <div class="format-option active" data-format="jpeg">
                                    <div class="format-icon">
                                        <i class="fas fa-file-image"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">JPG</div>
                                        <div class="text-xs text-gray-400">ضغط أعلى</div>
                                    </div>
                                </div>
                                
                                <div class="format-option" data-format="png">
                                    <div class="format-icon">
                                        <i class="fas fa-file-image"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">PNG</div>
                                        <div class="text-xs text-gray-400">جودة أعلى</div>
                                    </div>
                                </div>
                                
                                <div class="format-option" data-format="webp">
                                    <div class="format-icon">
                                        <i class="fas fa-file-image"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">WebP</div>
                                        <div class="text-xs text-gray-400">ضغط متقدم</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">تغيير أبعاد الصورة (اختياري)</label>
                        <div class="flex flex-wrap items-center gap-3 mb-2">
                            <div class="flex items-center">
                                <input type="checkbox" id="resizeCheckbox" class="mr-2">
                                <label for="resizeCheckbox" class="text-sm text-gray-300">تصغير الأبعاد</label>
                            </div>
                            
                            <div class="flex items-center gap-2">
                                <input type="number" id="widthInput" placeholder="العرض" class="w-24 bg-gray-700 text-white border border-gray-600 rounded px-2 py-1 text-sm" disabled>
                                <span class="text-gray-400">×</span>
                                <input type="number" id="heightInput" placeholder="الارتفاع" class="w-24 bg-gray-700 text-white border border-gray-600 rounded px-2 py-1 text-sm" disabled>
                                <span class="text-sm text-gray-400">بكسل</span>
                            </div>
                            
                            <div class="flex items-center">
                                <input type="checkbox" id="aspectRatioCheckbox" class="mr-2" checked disabled>
                                <label for="aspectRatioCheckbox" class="text-sm text-gray-300">الحفاظ على نسبة العرض للارتفاع</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-center mt-4">
                        <button id="compressBtn" class="btn btn-primary">
                            <i class="fas fa-compress-alt ml-2"></i>
                            ضغط الصورة
                        </button>
                    </div>
                </div>

                <!-- معلومات الملف الأصلي -->
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-info-circle text-blue-500"></i>
                        معلومات الملف
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="file-info">
                            <span class="text-sm text-gray-400">اسم الملف</span>
                            <span id="fileName" class="font-medium text-white">image.jpg</span>
                        </div>
                        
                        <div class="file-info">
                            <span class="text-sm text-gray-400">الصيغة الأصلية</span>
                            <span id="fileFormat" class="font-medium text-white">JPG</span>
                        </div>
                        
                        <div class="file-info">
                            <span class="text-sm text-gray-400">الأبعاد</span>
                            <span id="imageDimensions" class="font-medium text-white">1920 × 1080</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-700">
                        <div>
                            <div class="text-sm text-gray-400 mb-1">حجم الملف الأصلي</div>
                            <div class="size-badge original">
                                <i class="fas fa-weight-hanging ml-2"></i>
                                <span id="originalSize">2.5 MB</span>
                            </div>
                        </div>
                        
                        <div id="compressedSizeContainer" class="hidden">
                            <div class="text-sm text-gray-400 mb-1">حجم الملف المضغوط</div>
                            <div class="size-badge compressed">
                                <i class="fas fa-compress-alt ml-2"></i>
                                <span id="compressedSize">0.8 MB</span>
                            </div>
                        </div>
                        
                        <div id="reductionContainer" class="hidden">
                            <div class="text-sm text-gray-400 mb-1">نسبة التخفيض</div>
                            <div class="size-badge compressed">
                                <i class="fas fa-percentage ml-2"></i>
                                <span id="reductionPercentage">68%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- عرض الصورة -->
                <div id="previewContainer" class="section hidden">
                    <h2 class="section-title">
                        <i class="fas fa-eye text-purple-500"></i>
                        مقارنة قبل وبعد
                    </h2>
                    
                    <div id="compressionProgressContainer" class="mb-6 flex flex-col items-center">
                        <div class="loading-spinner"></div>
                        <p class="mt-2 text-gray-300">جاري ضغط الصورة...</p>
                    </div>
                    
                    <div id="comparisonContainer" class="comparison-container hidden">
                        <div class="comparison-image-container">
                            <span class="comparison-label original-label">الأصلية</span>
                            <img id="originalPreview" class="preview-image" />
                        </div>
                        
                        <div class="comparison-image-container">
                            <span class="comparison-label compressed-label">المضغوطة</span>
                            <img id="compressedPreview" class="preview-image" />
                        </div>
                    </div>
                    
                    <div id="downloadButtonContainer" class="flex justify-center mt-6 hidden">
                        <a id="downloadBtn" class="btn btn-success">
                            <i class="fas fa-download ml-2"></i>
                            تحميل الصورة المضغوطة
                        </a>
                    </div>
                </div>

                <!-- أزرار التحكم -->
                <div class="flex flex-wrap justify-center gap-3 mt-6 mb-4">
                    <button id="newImageBtn" class="btn btn-secondary">
                        <i class="fas fa-plus ml-2"></i>
                        صورة جديدة
                    </button>
                    <button id="resetSettingsBtn" class="btn btn-warning">
                        <i class="fas fa-redo ml-2"></i>
                        إعادة ضبط الإعدادات
                    </button>
                </div>
            </div>
            
            <!-- قسم التعليمات -->
            <div class="section mt-8">
                <h2 class="section-title">
                    <i class="fas fa-info-circle text-blue-500"></i>
                    كيفية ضغط الصور
                </h2>
                
                <div class="mb-6">
                    <div class="step">
                        <div class="step-number">1</div>
                        <div class="step-text">
                            <p>قم برفع الصورة التي تريد ضغطها (بصيغة JPG أو PNG)</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">2</div>
                        <div class="step-text">
                            <p>اضبط مستوى الضغط: قيمة أقل تعني حجم أصغر وجودة أقل، وقيمة أعلى تعني حجم أكبر وجودة أفضل</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">3</div>
                        <div class="step-text">
                            <p>اختر تنسيق الملف المضغوط (JPG أو PNG أو WebP) - كل تنسيق له مميزاته الخاصة</p>
                        </div>
                    </div>
                    
                    <div class="step">
                        <div class="step-number">4</div>
                        <div class="step-text">
                            <p>قم بضغط الصورة وقارن بين الأصلية والمضغوطة، ثم حمّل الصورة المضغوطة عندما تكون راضيًا عن النتيجة</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- قسم المميزات -->
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-star text-yellow-500"></i>
                    مميزات الأداة
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="feature-box">
                        <div class="feature-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <h3 class="font-bold mb-2">تحسين أداء الموقع</h3>
                        <p class="text-sm text-gray-400">صور أصغر حجماً تعني تحميل أسرع للصفحات وأداء أفضل للموقع</p>
                    </div>
                    
                    <div class="feature-box">
                        <div class="feature-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3 class="font-bold mb-2">توفير مساحة التخزين</h3>
                        <p class="text-sm text-gray-400">تحميل صور أصغر حجماً على هاتفك أو جهازك لتوفير مساحة التخزين</p>
                    </div>
                    
                    <div class="feature-box">
                        <div class="feature-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <h3 class="font-bold mb-2">تحسين تجربة المستخدم</h3>
                        <p class="text-sm text-gray-400">تقليل استهلاك بيانات الإنترنت وتسريع وقت التحميل لزوار موقعك</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- التذييل -->
        <footer class="mt-8 text-center">
            <div class="mb-4 flex justify-center space-x-4 rtl:space-x-reverse">
                <a href="https://twitter.com/_juz4" target="_blank" class="social-btn twitter-btn">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="https://t.me/jz_u4" target="_blank" class="social-btn telegram-btn">
                    <i class="fab fa-telegram-plane"></i>
                </a>
            </div>
            <p class="text-gray-400 text-sm">
                جميع الحقوق محفوظة للمطور 
                <a href="https://twitter.com/_juz4" target="_blank" class="footer-link">Rives</a>
                &copy; 2025
            </p>
        </footer>
    </div>
    
    <script>
        // المتغيرات
        let originalImage = null;
        let compressedImage = null;
        let originalBlob = null;
        let compressedBlob = null;
        let imageFormat = 'jpeg';
        let originalWidth = 0;
        let originalHeight = 0;
        let processing = false;
        
        // عناصر واجهة المستخدم
        const fileInput = document.getElementById('fileInput');
        const dropZone = document.getElementById('dropZone');
        const selectFileBtn = document.getElementById('selectFileBtn');
        const uploadSection = document.getElementById('uploadSection');
        const editorContainer = document.getElementById('editorContainer');
        const previewContainer = document.getElementById('previewContainer');
        const originalPreview = document.getElementById('originalPreview');
        const compressedPreview = document.getElementById('compressedPreview');
        
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValueDisplay = document.getElementById('qualityValueDisplay');
        const formatOptions = document.querySelectorAll('.format-option');
        
        const resizeCheckbox = document.getElementById('resizeCheckbox');
        const widthInput = document.getElementById('widthInput');
        const heightInput = document.getElementById('heightInput');
        const aspectRatioCheckbox = document.getElementById('aspectRatioCheckbox');
        
        const fileName = document.getElementById('fileName');
        const fileFormat = document.getElementById('fileFormat');
        const imageDimensions = document.getElementById('imageDimensions');
        const originalSize = document.getElementById('originalSize');
        const compressedSize = document.getElementById('compressedSize');
        const reductionPercentage = document.getElementById('reductionPercentage');
        
        const compressedSizeContainer = document.getElementById('compressedSizeContainer');
        const reductionContainer = document.getElementById('reductionContainer');
        const compressionProgressContainer = document.getElementById('compressionProgressContainer');
        const comparisonContainer = document.getElementById('comparisonContainer');
        const downloadButtonContainer = document.getElementById('downloadButtonContainer');
        
        const compressBtn = document.getElementById('compressBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const newImageBtn = document.getElementById('newImageBtn');
        const resetSettingsBtn = document.getElementById('resetSettingsBtn');
        
        // تهيئة التطبيق
        function initApp() {
            // زر اختيار ملف
            selectFileBtn.addEventListener('click', () => {
                fileInput.click();
            });
            
            // معالجة اختيار ملف
            fileInput.addEventListener('change', handleFileSelect);
            
            // منطقة السحب والإفلات
            setupDropZone();
            
            // إعدادات الضغط
            setupUIControls();
            
            // خيارات تنسيق الملف
            setupFormatOptions();
            
            // أزرار التحكم
            compressBtn.addEventListener('click', compressImage);
            downloadBtn.addEventListener('click', downloadImage);
            newImageBtn.addEventListener('click', () => {
                editorContainer.classList.add('hidden');
                uploadSection.classList.remove('hidden');
                previewContainer.classList.add('hidden');
                fileInput.value = '';
            });
            resetSettingsBtn.addEventListener('click', resetSettings);
            
            // معالجة تغيير الأبعاد
            setupResizeOptions();
        }
        
        // إعداد منطقة السحب والإفلات
        function setupDropZone() {
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('active');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('active');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('active');
                
                if (e.dataTransfer.files.length) {
                    handleFileSelect({ target: { files: e.dataTransfer.files } });
                }
            });
        }
        
        // إعداد عناصر التحكم في الواجهة
        function setupUIControls() {
            // مزلق الجودة
            qualitySlider.addEventListener('input', () => {
                qualityValueDisplay.textContent = qualitySlider.value + "%";
            });
        }
        
        // إعداد خيارات تنسيق الملف
        function setupFormatOptions() {
            formatOptions.forEach(option => {
                option.addEventListener('click', () => {
                    // إزالة الفئة النشطة من جميع الخيارات
                    formatOptions.forEach(o => o.classList.remove('active'));
                    // إضافة الفئة النشطة إلى الخيار المحدد
                    option.classList.add('active');
                    // تحديث التنسيق المحدد
                    imageFormat = option.dataset.format;
                });
            });
        }
        
        // إعداد خيارات تغيير الأبعاد
        function setupResizeOptions() {
            resizeCheckbox.addEventListener('change', () => {
                widthInput.disabled = !resizeCheckbox.checked;
                heightInput.disabled = !resizeCheckbox.checked;
                aspectRatioCheckbox.disabled = !resizeCheckbox.checked;
                
                if (resizeCheckbox.checked && originalImage) {
                    widthInput.value = originalWidth;
                    heightInput.value = originalHeight;
                }
            });
            
            widthInput.addEventListener('input', () => {
                if (aspectRatioCheckbox.checked && originalImage) {
                    const newWidth = parseInt(widthInput.value) || 0;
                    if (newWidth > 0) {
                        const ratio = originalHeight / originalWidth;
                        heightInput.value = Math.round(newWidth * ratio);
                    }
                }
            });
            
            heightInput.addEventListener('input', () => {
                if (aspectRatioCheckbox.checked && originalImage) {
                    const newHeight = parseInt(heightInput.value) || 0;
                    if (newHeight > 0) {
                        const ratio = originalWidth / originalHeight;
                        widthInput.value = Math.round(newHeight * ratio);
                    }
                }
            });
        }
        
        // معالجة اختيار ملف
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file || !file.type.match('image/(jpeg|png)')) {
                alert('يرجى اختيار ملف صورة صالح بصيغة JPG أو PNG');
                return;
            }
            
            originalBlob = file;
            
            // تحديث معلومات الملف
            updateFileInfo(file);
            
            const reader = new FileReader();
            reader.onload = function(e) {
                originalImage = new Image();
                originalImage.onload = function() {
                    // تحديث الأبعاد الأصلية
                    originalWidth = originalImage.width;
                    originalHeight = originalImage.height;
                    
                    // تحديث عرض الأبعاد
                    imageDimensions.textContent = `${originalWidth} × ${originalHeight}`;
                    
                    // إظهار واجهة التحرير
                    uploadSection.classList.add('hidden');
                    editorContainer.classList.remove('hidden');
                    
                    // تحديث معاينة الصورة الأصلية
                    originalPreview.src = e.target.result;
                    
                    // إعادة ضبط حالة الضغط
                    resetCompressionState();
                };
                originalImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // تحديث معلومات الملف
        function updateFileInfo(file) {
            fileName.textContent = file.name;
            const formatMatch = file.name.match(/\.([^.]+)$/);
            fileFormat.textContent = formatMatch ? formatMatch[1].toUpperCase() : 'غير معروف';
            originalSize.textContent = formatFileSize(file.size);
        }
        
        // إعادة ضبط حالة الضغط
        function resetCompressionState() {
            compressedSizeContainer.classList.add('hidden');
            reductionContainer.classList.add('hidden');
            previewContainer.classList.add('hidden');
            comparisonContainer.classList.add('hidden');
            downloadButtonContainer.classList.add('hidden');
            compressionProgressContainer.classList.add('hidden');
            
            compressedImage = null;
            compressedBlob = null;
        }
        
        // إعادة ضبط الإعدادات
        function resetSettings() {
            qualitySlider.value = 80;
            qualityValueDisplay.textContent = "80%";
            
            formatOptions.forEach(o => o.classList.remove('active'));
            formatOptions[0].classList.add('active');
            imageFormat = 'jpeg';
            
            resizeCheckbox.checked = false;
            widthInput.disabled = true;
            heightInput.disabled = true;
            aspectRatioCheckbox.disabled = true;
            
            if (originalImage) {
                widthInput.value = originalWidth;
                heightInput.value = originalHeight;
            } else {
                widthInput.value = '';
                heightInput.value = '';
            }
            
            aspectRatioCheckbox.checked = true;
        }
        
        // ضغط الصورة
        function compressImage() {
            if (!originalImage || processing) return;
            
            processing = true;
            compressBtn.disabled = true;
            
            // إظهار مؤشر التقدم
            previewContainer.classList.remove('hidden');
            compressionProgressContainer.classList.remove('hidden');
            comparisonContainer.classList.add('hidden');
            downloadButtonContainer.classList.add('hidden');
            
            // الحصول على الإعدادات الحالية
            const quality = parseInt(qualitySlider.value) / 100;
            const resize = resizeCheckbox.checked;
            const targetWidth = resize ? parseInt(widthInput.value) || originalWidth : originalWidth;
            const targetHeight = resize ? parseInt(heightInput.value) || originalHeight : originalHeight;
            
            // تأخير للمحاكاة (في تطبيق حقيقي لن نحتاج لهذا)
            setTimeout(() => {
                // ضغط الصورة
                compressImageWithSettings(quality, imageFormat, targetWidth, targetHeight);
            }, 1000);
        }
        
        // ضغط الصورة بالإعدادات المحددة
        function compressImageWithSettings(quality, format, width, height) {
            // إنشاء قماش بالأبعاد المطلوبة
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // ضبط أبعاد القماش
            canvas.width = width;
            canvas.height = height;
            
            // رسم الصورة الأصلية على القماش بالحجم الجديد
            ctx.drawImage(originalImage, 0, 0, width, height);
            
            // تحويل القماش إلى بيانات URL مع تطبيق الضغط
            let mimeType;
            switch(format) {
                case 'png':
                    mimeType = 'image/png';
                    break;
                case 'webp':
                    mimeType = 'image/webp';
                    break;
                default:
                    mimeType = 'image/jpeg';
                    break;
            }
            
            // الحصول على بيانات URL المضغوطة
            canvas.toBlob(blob => {
                // تخزين الـ blob المضغوط
                compressedBlob = blob;
                
                // تحويل الـ blob إلى URL للعرض
                const compressedURL = URL.createObjectURL(blob);
                
                // تحميل الصورة المضغوطة
                compressedImage = new Image();
                compressedImage.onload = function() {
                    // تحديث معاينة الصورة المضغوطة
                    compressedPreview.src = compressedURL;
                    
                    // تحديث معلومات الحجم
                    compressedSize.textContent = formatFileSize(blob.size);
                    compressedSizeContainer.classList.remove('hidden');
                    
                    // حساب نسبة التخفيض
                    const reduction = 100 - Math.round(blob.size / originalBlob.size * 100);
                    reductionPercentage.textContent = `${reduction}%`;
                    reductionContainer.classList.remove('hidden');
                    
                    // إخفاء مؤشر التقدم وإظهار المقارنة
                    compressionProgressContainer.classList.add('hidden');
                    comparisonContainer.classList.remove('hidden');
                    downloadButtonContainer.classList.remove('hidden');
                    
                    // تحديث رابط التنزيل
                    downloadBtn.href = compressedURL;
                    downloadBtn.download = getCompressedFileName();
                    
                    // إنهاء المعالجة
                    processing = false;
                    compressBtn.disabled = false;
                };
                compressedImage.src = compressedURL;
            }, mimeType, quality);
        }
        
        // الحصول على اسم الملف المضغوط
        function getCompressedFileName() {
            // اسم الملف الأصلي
            const originalName = fileName.textContent;
            // إزالة اللاحقة
            const nameWithoutExt = originalName.replace(/\.[^.]+$/, '');
            // إضافة لاحقة جديدة
            let ext;
            switch(imageFormat) {
                case 'png':
                    ext = '.png';
                    break;
                case 'webp':
                    ext = '.webp';
                    break;
                default:
                    ext = '.jpg';
                    break;
            }
            
            return `${nameWithoutExt}_compressed${ext}`;
        }
        
        // تنسيق حجم الملف
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // تحميل الصورة المضغوطة
        function downloadImage() {
            if (!compressedImage) return;
            
            // التنزيل يتم عبر تحديد الرابط والاسم في عنصر الرابط
            // لا نحتاج لأي كود هنا لأن الرابط محدث بالفعل
        }
        
        // تهيئة التطبيق عند تحميل الصفحة
        window.onload = initApp;
    </script>
</body>
</html>
